<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>アオガネ残席情報画像</title>
    <style>
        #container {
            position: relative;
            display: inline-block;
            width: 90vw;
        }
        #baseImage, #previewImage {
            width: 90vw;
            height: auto;
        }
        .marker {
            position: absolute;
            font-size: 60px;
            font-weight: bold;
            color: #c73d4d;
        }
        #previewImage {
            display: block;
            margin-top: 10px;
            max-width: 100%;
        }
    </style>
</head>
<body>
    <input type="number" id="input2" placeholder="9/12(金) 19:00回">
    <br>
    <input type="number" id="input3" placeholder="9/13(土) 14:00回">
    <input type="number" id="input4" placeholder="9/13(土) 18:00回">
    <br>
    <input type="number" id="input5" placeholder="9/14(日) 13:00回">
    <input type="number" id="input6" placeholder="9/14(日) 17:00回">
    <button onclick="processImage()">確定</button>
    <button onclick="saveImage()">保存</button>
    
    <br><br>
    <div id="container">
        <img id="baseImage" src="アオガネ_残席情報フォーマット_base-01.jpg" alt="背景画像">
        <img id="previewImage" alt="プレビュー画像" style="display:none;">
    </div>

    <script>
    function processImage() {
        const positions = [
            { left: 400, top: 670 },
            { left: 590, top: 670 },
            { left: 780, top: 470 },
            { left: 780, top: 670 },
            { left: 970, top: 470 },
            { left: 970, top: 670 }
        ];
        
        const values = [
            document.getElementById('input1')?.value || "",
            document.getElementById('input2').value,
            document.getElementById('input3').value,
            document.getElementById('input4').value,
            document.getElementById('input5').value,
            document.getElementById('input6').value
        ];

        // 画像ファイル名をvalueに応じて取得
        function getAssetImage(value) {
            if (value <= 0) return "アセット5.png";
            if (value <= 5) return "アセット4.png";
            if (value <= 10) return "アセット3.png";
            if (value <= 20) return "アセット2.png";
            if (value <= 30) return "アセット1.png";
            return null;
        }

        // 各位置に画像を設定（テキストマーカーは廃止）
        positions.forEach((pos, i) => {
            const val = parseInt(values[i]);
            if (!isNaN(val)) {
                const image = getAssetImage(val);
                if (image) {
                    pos.image = image;
                }
            }
        });

        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        const baseImage = document.getElementById('baseImage');

        canvas.width = baseImage.naturalWidth;
        canvas.height = baseImage.naturalHeight;
        ctx.drawImage(baseImage, 0, 0);

        let imagesLoaded = 0;
        let totalImages = positions.filter(p => p.image).length;

        function drawPreview() {
            const previewImage = document.getElementById('previewImage');
            previewImage.src = canvas.toDataURL("image/png");
            previewImage.style.display = "block";
        }

        if (totalImages === 0) {
            drawPreview();
            return;
        }

        positions.forEach((pos) => {
            if (pos.image) {
                const img = new Image();
                img.src = pos.image;
                img.onload = function () {
                    ctx.drawImage(img, pos.left - 60, pos.top - 60, 120, 120);
                    imagesLoaded++;
                    if (imagesLoaded === totalImages) {
                        drawPreview();
                    }
                };
                img.onerror = function () {
                    console.error("画像の読み込みに失敗しました:", pos.image);
                    imagesLoaded++;
                    if (imagesLoaded === totalImages) {
                        drawPreview();
                    }
                };
            }
        });
    }
</script>
    
</body>
</html>
